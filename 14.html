<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaflet Polygons</title>
    <!-- Include Leaflet CSS and JavaScript -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Include Leaflet.Draw CSS and JavaScript (for drawing and editing polygons) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"
    />
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
    <style>
      #map {
        height: 400px;
      }
      #polygon-table {
        margin-top: 20px;
        border-collapse: collapse;
        width: 100%;
      }
      #polygon-table th,
      #polygon-table td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
        cursor: grab;
      }
      #polygon-table th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <table id="polygon-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      // Initialize Leaflet map
      var map = L.map("map").setView([32.09, 35.35], 14); // Set initial coordinates and zoom level

      // Add base map layer
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // Initialize Leaflet.draw control
      var drawnItems = new L.FeatureGroup();
      map.addLayer(drawnItems);
      var drawControl = new L.Control.Draw({
        draw: {
          polygon: true,
          polyline: false,
          rectangle: false,
          circle: false,
          marker: false,
        },
        edit: {
          featureGroup: drawnItems,
        },
      });
      map.addControl(drawControl);

      // Event listener to save newly added polygon
      map.on("draw:created", function (e) {
        var layer = e.layer;
        drawnItems.addLayer(layer);
        updatePolygonTable();
      });

      // Define array to hold polygon coordinates, names, and colors
      var polygons = [
        {
          name: "cam07",
          points: [
            [32.08825885045881, 35.343742702621945],
            [32.088148717179465, 35.34356261746145],
            [32.085248, 35.352275],
            [32.089746, 35.348854],
          ],
          color: "blue",
        },
        {
          name: "cam08",
          points: [
            [32.0882984040723, 35.344341367904],
            [32.08829847778584, 35.34407503431201],
            [32.087425, 35.343644],
            [32.087211, 35.344182],
          ],
          color: "green",
        },
        {
          name: "cam09",
          points: [
            [32.08852253669535, 35.344344254876276],
            [32.08838071696342, 35.34462577886467],
            [32.0886618, 35.3458845],
            [32.089747, 35.348856],
            [32.0917895, 35.3481805],
            [32.088749, 35.3443798],
          ],
          color: "red",
        },
        {
          name: "cam10",
          points: [
            [32.088978362667376, 35.344512973551474],
            [32.088818890504264, 35.3447199146097],
            [32.08385, 35.354687],
            [32.089747, 35.348856],
          ],
          color: "orange",
        },
        {
          name: "cam11",
          points: [
            [32.08930947969753, 35.34484095702445],
            [32.08917493523005, 35.34471718611244],
            [32.088443, 35.34553],
            [32.088472, 35.34551],
          ],
          color: "purple",
        },
        {
          name: "cam12",
          points: [
            [32.08943479432297, 35.34482097732823],
            [32.08927384145962, 35.344760131016365],
            [32.0892728, 35.3465457],
            [32.0898147, 35.3455191],
          ],
          color: "yellow",
        },
        {
          name: "cam13",
          points: [
            [32.089874565781784, 35.344686974262935],
            [32.08974075058895, 35.344848410461154],
            [32.090011, 35.34517],
            [32.092402, 35.345814],
          ],
          color: "cyan",
        },
        {
          name: "cam14",
          points: [
            [32.0899382691109, 35.3445947210146],
            [32.08985719501438, 35.34479502755884],
            [32.0898147, 35.3455191],
            [32.090649, 35.3455275],
          ],
          color: "magenta",
        },
        {
          name: "cam15",
          points: [
            [32.09056564381478, 35.344573510472934],
            [32.09040282492378, 35.34475369952641],
            [32.090339, 35.344187],
            [32.090354, 35.344199],
          ],
          color: "lime",
        },
        {
          name: "cam16",
          points: [
            [32.0909102789318, 35.3444374386421],
            [32.09078864733787, 35.34448785083747],
            [32.091148, 35.345208],
            [32.091162, 35.345206],
          ],
          color: "teal",
        },
        {
          name: "cam17",
          points: [
            [32.09111076736931, 35.344404024927904],
            [32.090956071453, 35.34464992071406],
            [32.0909615, 35.3480165],
            [32.0914213, 35.3446031],
          ],
          color: "navy",
        },
        {
          name: "cam18",
          points: [
            [32.0913085412177, 35.3441069909949],
            [32.091165380076475, 35.344239735138274],
            [32.090011, 35.34517],
            [32.090344, 35.34418],
          ],
          color: "olive",
        },
        {
          name: "cam19",
          points: [
            [32.09143116243944, 35.34426365384145],
            [32.09131319695925, 35.34434885918572],
            [32.0909615, 35.3480165],
            [32.0924771, 35.3454021],
          ],
          color: "maroon",
        },
        {
          name: "cam20",
          points: [
            [32.09146657533103, 35.34411822555159],
            [32.091432866043995, 35.344496725729165],
            [32.092404, 35.343989],
            [32.092393, 35.343975],
          ],
          color: "gray",
        },
        {
          name: "cam21",
          points: [
            [32.09349129621524, 35.34175071219077],
            [32.093354938669094, 35.34174558157309],
            [32.093676, 35.342243],
            [32.0940604, 35.3419886],
          ],
          color: "silver",
        },
        {
          name: "cam22",
          points: [
            [32.09342517211478, 35.341387911714676],
            [32.0932962740759, 35.341515013277],
            [32.0936408, 35.3420262],
            [32.0941274, 35.341422],
          ],
          color: "gold",
        },
        {
          name: "cam23",
          points: [
            [32.093409026101654, 35.34130574154254],
            [32.09337952031261, 35.34147348633582],
            [32.0942654, 35.3412681],
            [32.094537, 35.339699],
          ],
          color: "brown",
        },
        {
          name: "cam24",
          points: [
            [32.0933284741068, 35.34119533234016],
            [32.09347614738957, 35.34137227002747],
            [32.095156, 35.339154],
            [32.092752, 35.339455],
          ],
          color: "azure",
        },
        {
          name: "cam25",
          points: [
            [32.0932211635977, 35.34135063701579],
            [32.0933063366781, 35.3413089827982],
            [32.092851, 35.338859],
            [32.091067, 35.340332],
          ],
          color: "coral",
        },
        {
          name: "cam26",
          points: [
            [32.0925344990144, 35.3409136948386],
            [32.09264902786587, 35.34084184822198],
            [32.0930634, 35.3388347],
            [32.091926, 35.339878],
          ],
          color: "pink",
        },
      ];
      // Loop through existing polygons array and add them to the map
      function addPolygonsToMap() {
        drawnItems.clearLayers();
        polygons.forEach(function (polygon) {
          var poly = L.polygon(polygon.points, { color: polygon.color });
          drawnItems.addLayer(poly);
          poly.bindPopup(polygon.name);
        });
      }
      addPolygonsToMap();

      // Function to update the polygon table
      function updatePolygonTable() {
        var tableBody = document.querySelector("#polygon-table tbody");
        tableBody.innerHTML = "";
        polygons.forEach(function (polygon) {
          var row = tableBody.insertRow();
          var nameCell = row.insertCell(0);
          var pointsCell = row.insertCell(1);
          nameCell.textContent = polygon.name;
          pointsCell.textContent = JSON.stringify(polygon.points);
          row.draggable = true;
          // Add event listeners for drag and drop
          row.addEventListener("dragstart", function (e) {
            e.dataTransfer.setData("text/plain", JSON.stringify(polygon));
          });
          row.addEventListener("dragover", function (e) {
            e.preventDefault();
          });
          row.addEventListener("drop", function (e) {
            e.preventDefault();
            var draggedPolygon = JSON.parse(
              e.dataTransfer.getData("text/plain")
            );
            var newIndex = Array.from(e.target.parentNode.children).indexOf(
              e.target
            );
            var oldIndex = polygons.findIndex(function (item) {
              return item.name === draggedPolygon.name;
            });
            polygons.splice(newIndex, 0, polygons.splice(oldIndex, 1)[0]);
            updatePolygonTable();
            addPolygonsToMap(); // Update the order on the map
          });
        });
      }

      // Initial update of the polygon table
      updatePolygonTable();
    </script>
  </body>
</html>
